title: 移动前端调试大全
category: 技术
date: 2017-07-03 00:00:00
tags: [Mobile, Web, Debug, AppHelper]
photos: [http://img.kuqin.com/upimg/allimg/161222/1224556264-0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240]
---

随着 PC 市场的逐渐饱和、网络和移动设备性能的不断提升，人们越来越离不开手机等移动设备，手机逐渐成为生活的必需品。据调查显示，中国人花在手机上的时间平均每天 3 小时，居全球第二。Qunar 从 09 年率先布局无线业务至今，移动端一直承担着大量的业务需求，Qunar 移动端项目早已超过了 100 大关，移动端成为 Qunar 业务的主战场。业务产品能否迅速上线、占据市场，高效地开发测试成为重要影响因素之一，那么移动端调试的重要性也就不言而喻了。
<!-- more -->笔者根据不同的移动端场景，主要基于 Mac 来分享一下如何进行 Web 调试：

## 移动端页面本地调试

移动端页面本地模拟的调试工具首推 Chrome 浏览器（PS. Firefox 的 Firebug 团队已经宣布不再更新维护），借助 Chrome 浏览器自带的 DevTools，可以模拟移动设备的 user-agent，视窗大小、缩放，获取页面元素样式，查看 console 日志，网络请求，断点调试和性能测试等。以下只做简要介绍，具体使用可以参考 [官方文档](https://developers.google.com/web/tools/) 。

### 使用模拟器

+ 通过右键，选择检查，开启 DevTools，推荐使用快捷键 `Command + Option + I (Mac) / Ctrl + Shift + I, F12 (Windows)`
+ 点击 Device Mode 按钮或使用快捷键 `Command + Shift + M (Mac) / Ctrl + Shift + M (Windows)` 打开模拟器

![Devtools](http://wx1.sinaimg.cn/large/c4b5f11bly1fh5vv4qjogj20j60citb7.jpg)

### 审阅元素和样式

![Devtools-domStyle](http://wx4.sinaimg.cn/large/c4b5f11bly1fh5vv5mwuej20g4086mzh.jpg)

### console 日志

![Devtools-console](http://wx3.sinaimg.cn/large/c4b5f11bly1fh5vv3jqrgj20j807cjsk.jpg)


### 断点调试

![Devtools-debug](http://wx3.sinaimg.cn/large/c4b5f11bly1fh5vv42p2xj20r10ewaek.jpg)



## 移动设备浏览器调试

虽然使用 Chrome 浏览器的 DevTools 可以解决多数场景的调试工作，但因为其只是模拟移动端的环境，与真实的设备还是存在区别的，所以使用移动设备进行调试验证是很有必要的。

### iOS 平台

#### 调试 Safari 浏览器：

+ 在 iOS 设备上打开允许调试（第一次使用该设备调试时需要）：设置 -> Safari -> 高级 -> 打开“Web检查器”
+ 在 Mac 的 Safari 上打开“开发”菜单项（第一次使用该功能调试时需要）：顶部菜单栏 “Safari” -> 偏好设置 -> 高级 -> 勾选“在菜单栏中显示‘开发’菜单”
+ 用数据线连接 iOS 设备和 Mac，在 iOS 设备 Safari 上打开需要调试的页面 -> Mac Safari 顶部菜单栏的“开发”项中找到连接的 iOS 设备（例如：XXX 的 iPhone）-> 在二级菜单中找到需要调试的标签页 -> 点击打开“网页检查器”（与 Chrome 的 DevTools 类似），开始调试
+ 如果没有 iOS 设备，可以使用 Xcode 的模拟器，打开 Xcode 点击顶部 “Xcode” -> “Open Developer Tool” -> “Simulator” 即可打开一个 iOS 设备模拟器，调试步骤和真机一致

![iOS-Safari](http://wx2.sinaimg.cn/large/c4b5f11bly1fh5vv78u2mj218u0ncn8e.jpg)


### Android 平台

#### 调试 Chrome 浏览器
+ 在 Android 设备上安装 Chrome 浏览器
+ 在 Mac 上安装 Chrome 浏览器（Windows 需要对应 Android 设备 [驱动](https://developer.android.com/studio/run/oem-usb.html)）
+ 开启当前 Android 设备的 USB 调试：设置 -> 应用程序 -> 开发 -> USB调试（不同 Android 设备开启方式可能不同）
+ 用 USB 线连接 Android 设备，在 Mac 上的 Chrome 地址栏输入 `chrome://inspect/#devices`，然后回车进入
+ 在 Android 设备上弹出的是否允许远程调试上，选择“允许”
+ 在页面列表中选择需要调试的页面地址，点击 `inspect` 打开 Developer Tools 进行调试
+ Windows 平台与之类似

![Android-Chrome](http://wx2.sinaimg.cn/large/c4b5f11bly1fh5vuvhbxfj20g509fabl.jpg)

#### 调试 UC 浏览器
+ 在 Android 设备上安装 [UC 浏览器开发者版](http://wap.uc.cn/index.php?action=PackageDown&do=ByPfid&product=UCBrowser&pfid=145&lang=zh-cn&bid=33533&direct=true&from=dev-slp-dir-pc)
+ 具体请查看 UC [官方文档](http://plus.uc.cn/document/webapp/doc5.html)

## 移动设备 App 内网页调试

随着业务需求的迅猛扩张，客户端的迭代频率随之加快，客户端体积也快速增长，传统的 Native 开发终将无法满足业务的发展，因此，基于 Web 的 Hybrid 混合开发方案逐渐成为各大应用的一大选择。随之而来的问题是移动应用中的页面将如何进行调试呢？因为应用的 Web 页面运行在其 WebView/UIWebView 中，我们可以简单理解为一个微型浏览器，所以调试移动应用 Web 页面的方式和普通的浏览器很相似。

### iOS 平台

+ 获取 iOS 设备的 udid，用数据线连接 Mac 和设备，通过 iTunes 获取

![iOS-udid](http://wx2.sinaimg.cn/large/c4b5f11bly1fh5vv7sxfxj210k0eujtd.jpg)

+ 将 iOS 设备的 udid 加入到证书的设备白名单并打测试包
+ 在 iOS 设备上安装需要调试的应用
+ 其他操作与调试 Safari 浏览器类似

![iOS-App](http://wx1.sinaimg.cn/large/c4b5f11bly1fh5vv6loadj219q0nkdrr.jpg)


### Android 平台

+ 要求 Android 系统必须是 4.4 及以上，且需要翻墙（需要访问谷歌服务，否则打开的 Developer Tools 出现白屏）
+ 在 Android 设备上安装需要调试的应用
+ 与调试 Android 下的 Chrome 类似，均需开启 USB 调试，远程调试
+ 在应用中打开需要调试的页面
+ 通过 Chrome 进入 `chrome://inspect/#devices`
+ 在页面列表中选择需要调试的页面，点击 `inspect` 打开 Developer Tools 进行调试
+ Windows 平台与之类似

![Android-App](http://wx1.sinaimg.cn/large/c4b5f11bly1fh5vuut9prj20h60d0jtc.jpg)

## 微信环境本地调试

基于微信的 Web 调试，可以通过微信官方的“微信 web 开发者工具”或真机进行调试，这两种方式都存在一定局限局限性，官方调试工具必须绑定开发者账号（每个公众号可绑定的开发账号最多 10 个），而真机调试只适用于 Android 设备。

### 微信 web 开发者工具
+ 下载并安装“微信 web 开发者工具” [Mac 版](https://mp.weixin.qq.com/debug/cgi-bin/webdebugger/download?from=mpwiki&os=darwin)
+ 在微信公众服务平台对某个公众号进行开发授权，绑定开发者微信账号
+ 使用授权过的微信账号登录“微信 web 开发者工具”
+ 在地址栏输入需要调试的页面，利用工具自带的 DevTools 进行调试
+ 更多细节，可以查阅微信 [官方文档](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784140)
+ Windows 平台与之类似

![wechat-tool](http://wx1.sinaimg.cn/large/c4b5f11bly1fh5vv94cyrj21kw0q4139.jpg)

### 真机调试

#### Android 平台
+ 打开微信，设法打开网址 `http://debugx5.qq.com`，推荐直接把该网址发送给文件传输助手，进到文件传输助手，点击网址直接打开
+ 在打开的网页中选择 【信息】-> 【TBS settings】，勾选【是否打开 TBS 内核 Inspector 调试功能】
+ 微信提示需要重启，根据提示点击重启
+ 在微信中打开需要调试的页面，终于可以愉快的调试了
+ 调试 Android 版微信的页面与前文提及的 Android Chrome 浏览器、Android 移动应用的方式一致，故在此不再赘述了。
![Android-wechat](http://wx2.sinaimg.cn/large/c4b5f11bly1fh5vuvzyv1j21kw0r8wjy.jpg)

## 其他

### 调试本地项目

调试的核心主要是通过 Charles 或 Fiddler 等工具，将移动设备代理到 PC 上，即可使用移动设备来调试本地项目。下文将以 Charles 为例，来进行说明：

+ 移动设备与 PC 连接同一网络并保证都在同一个网段，推荐使用 Mac 的“互联网共享”：系统偏好设置 -> 共享 -> 点击“互联网共享”（非勾选），设置共享来源、端口，端口指定 “Wi-Fi” -> 点击 “Wi-Fi 选项”，配置网络名称和密码 -> 勾选互联网共享并确定启用

![WIFI](http://wx3.sinaimg.cn/large/c4b5f11bly1fh6hoo0tg9j20te07yn0m.jpg)

+ 开启 Charles -> 顶部菜单栏 “Proxy”，勾选二级菜单 “Mac OS X Proxy”
+ 菜单栏 “Proxy” -> 点击二级菜单 “Proxy Settings” 指定代理的端口，默认 `8888`
+ 点击 系统偏好设置 -> 网络 -> Wi-Fi，查看 PC 的 ip（例如：169.254.114.1）
+ iOS 设备：点击连接的无线网右侧的感叹号 -> HTTP 代理设置为“手动” -> 输入步骤 4 获取的 ip 地址，步骤 3 设置的端口号

![iOS-WIFI](http://wx2.sinaimg.cn/large/c4b5f11bly1fh6i5t3y9mj20fh0dp76a.jpg)

+ Android 设备：长按连接的无线网 -> 修改网络 -> 勾选显示高级选项 -> 代理设置为手动 -> 输入 ip 和端口号 -> 保存

![Android-WIFI](http://wx4.sinaimg.cn/large/c4b5f11bly1fh6i5tpqo2j20dg0bv765.jpg)

+ 开始调试
+ Windows 使用 Fiddler，具体操作与 Charles 类似

### 特殊场景

针对一些特殊的场景，例如：Android 设置系统低于 4.4，iOS 设备中的 UC、QQ 浏览器等，可以使用 weinre 或 spy-debugger 等手段进行调试，笔者在此不再详细说明。

## 写在最后

调试是开发测试过程中相当重要、不可忽视的一环，掌握了各种调试手段，使用强大的工具，不仅让开发测试工作能够更加高效地进行，还使得开发测试不再饱受折磨，本文主要针对当前多数业务场景，介绍了主要的调试工具和技巧，以实际操作为主，在阅读过程中读者可以实际动手尝试，希望对之后的开发调试有一定的借鉴参考作用，如有错误，敬请斧正。
